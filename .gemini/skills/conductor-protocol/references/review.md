# **Review Protocol**

実装された変更を、プロジェクト基準、設計ガイドライン、および元の計画に照らして監査する手順を規定する。

## **1. スコープの特定**

1.  **自動検出**: `Tracks Registry` を読み込み、`In Progress` のトラックを探せ。
2.  **確認**: ユーザーに「このトラックをレビューするか？」を確認せよ。

## **2. 文脈のロード**

1.  **ガイドライン読込**: `product-guidelines.md`, `tech-stack.md`、および `conductor/code_styleguides/` 配下の全ファイルを読み込め。これらは **「法」** である。
2.  **トラック履歴の解析**: `plan.md` からコミットハッシュを抽出し、リビジョン範囲（開始〜終了）を特定せよ。

## **3. 変更内容の分析 (Smart Chunking)**

1.  **サイズ確認**: `git diff --shortstat` を実行せよ。
2.  **戦略選択**:
    -   **Small/Medium (< 300行)**: 一括で diff を取得し分析せよ。
    -   **Large (> 300行)**: 「Iterative Review Mode」を宣言し、ファイルごとに diff を読み込んで分析せよ。

## **4. 監査と検証**

以下のチェックを diff に対して実行せよ。
1.  **意図の検証**: `plan.md` の要求を正しく満たしているか。
2.  **スタイル準拠**: `code_styleguides/*.md` の「掟」を厳格に守っているか。
3.  **正確性と安全性**: バグ、レースコンディション、`unsafe` の不適切な使用、シークレットの漏洩がないか。
4.  **テスト実行**: テストスイートを自動実行し、結果を分析せよ。

## **5. 報告書の作成**

指定されたフォーマット（# Review Report）で、重要度（CRITICAL/HIGH/MEDIUM/LOW）を付与して報告せよ。

## **6. 意思決定とクリーンアップ**

1.  **修正の要否**: 重大な問題がある場合は修正を推奨せよ。
2.  **アクション選択**: ユーザーに「A. 修正適用」「B. 手動修正」「C. 完了（無視）」を選択させよ。
3.  **アーカイブ**: レビュー完了後、トラックを `conductor/archive/` へ移動し、レジストリを更新せよ。
