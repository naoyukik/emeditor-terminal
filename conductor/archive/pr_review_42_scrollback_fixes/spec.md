# PR #42 Review Fixes 仕様書

## 概要
PR #42 で実装されたスクロールバック機能およびリファクタリングに対し、コードレビューで指摘された重大なバグ（IME消失、UX欠陥）および設計上の問題（カプセル化違反）を修正する。

## 修正対象

### 1. IME 機能の復元 (Critical)
リファクタリング中に誤って削除された `WM_IME_*` メッセージハンドラを復元し、日本語入力を可能にする。
- 対象ファイル: `src/gui/custom_bar.rs`
- 復元すべきハンドラ:
    - `WM_IME_SETCONTEXT`
    - `WM_IME_STARTCOMPOSITION`
    - `WM_IME_COMPOSITION`
    - `WM_IME_ENDCOMPOSITION`

### 2. ナビゲーションキーによるスクロールリセットの防止 (UX)
現在、矢印キーや PageUp/PageDown を押しただけでビューポートが最新行にリセットされてしまうため、履歴の閲覧（スクロール操作）が困難になっている。これを修正し、文字入力時のみリセットするようにする。
- 変更内容: `WM_KEYDOWN` ハンドラ内で、ナビゲーションキー（矢印、Home/End, PageUp/PageDown）の場合は `reset_viewport` を呼ばないようにする。

### 3. 設計とコード品質の向上
- **カプセル化**: `TerminalService` のフィールド (`parser`, `conpty`) を private にし、外部からの直接操作を防ぐ。
- **慣習への準拠**: `AnsiParser` に `Default` トレイトを実装する。
- **警告対応**: 未使用のインポートや定数を整理する（IME復元により解消される見込み）。

## 受入条件
- [ ] 日本語入力（IME）が正常に行えること。変換ウィンドウが表示されること。
- [ ] 履歴閲覧中（スクロールアップ中）に矢印キーを押しても、勝手に最下部にスクロールしないこと。
- [ ] 文字を入力すると、最下部にスクロールすること。
- [ ] `cargo build` で警告が出ないこと。
