# Track Specification - Custom Window & ConPTY MVP

**概要**
EmEditor の「カスタムバー」機能を活用し、Windows Pseudo Console (ConPTY) をバックエンドとしたターミナル画面を表示するプラグイン機能を実装する。本トラックでは、技術的な実現可能性の調査から開始し、ConPTYからの出力をカスタムバー上にGDIで描画する「基礎実装 (MVP)」までをゴールとする。

**機能要件**
1.  **カスタムバー表示**:
    *   EmEditor の API (`EEID_SHOW_CUSTOM_BAR` 等) を使用し、プラグイン独自のカスタムバーを表示する。
    *   カスタムバー内に子ウィンドウを作成し、描画領域とする。
2.  **ConPTY 統合**:
    *   `CreatePseudoConsole` API を使用して PTY を作成する。
    *   プロセス（`cmd.exe`）を PTY に接続して起動する。
3.  **ターミナル描画 (GDI)**:
    *   ConPTY からの出力（テキスト）を解析し、GDI を使用してカスタムバー上のウィンドウに描画する。
    *   **範囲**: 今回はエスケープシーケンスの完全な解釈（色、カーソル移動）までは必須とせず、少なくとも「文字が流れるように表示される」ことを目指す。可能であれば基本的な VT100 シーケンスの除去または解釈を行う。
4.  **入力連携**:
    *   カスタムバー上のキー入力をフックし、ConPTY に送信する（Phase 1 のダイアログ方式からの脱却）。

**調査・検証項目 (Investigation)**
*   Rust (`windows` crate) から EmEditor のカスタムバー API を利用する方法。
*   カスタムバーのウィンドウハンドル (`HWND`) の取得方法。
*   ConPTY の非同期読み取りと GDI 描画ループの連携（再描画タイミング）。

**非機能要件**
*   **パフォーマンス**: エディタの動作を阻害しないよう、描画と通信は効率的に行う。
*   **安定性**: プラグインのクラッシュが EmEditor 本体を巻き込まないように注意する（が、FFIなのでリスクはある）。

**アウトオブスコープ**
*   完全な VT100/xterm エミュレーション（色、太字、カーソル移動の完全再現）。
*   リサイズ時の高度なリフロー処理。
*   フォント設定などのUI設定画面。
