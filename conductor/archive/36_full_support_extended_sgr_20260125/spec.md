# Specification - Issue #36: 拡張SGRシーケンスと属性の完全サポート

## 1. 概要
Windows Pseudo Console (ConPTY) から送られてくる SGR (Select Graphic Rendition) シーケンスを網羅的に解析し、文字の色（拡張色含む）およびフォントスタイルを EmEditor のカスタムバー上で正しく描画する。

## 2. 背景・目的
- 現状、標準16色以外の拡張色や一部のスタイル属性が無視されており、TUIアプリケーションの表示が意図通りでない。
- 未対応のシーケンスが「ゴミ文字」として表示されるのを防ぐ暫定処理を、正しい描画処理に置き換える。

## 3. 機能要件
### 3.1 SGR シーケンス解析の拡張 (`src/domain/terminal.rs`)
以下の SGR パラメータをサポートする：
- **基本スタイル**:
  - `0`: Reset (すべての属性をデフォルトに戻す)
  - `1`: Bold (太字)
  - `2`: Dim (暗い表示 - 今回は色を薄くすることで対応)
  - `3`: Italic (斜体)
  - `4`: Underline (下線)
  - `7`: Inverse (背景色と前景色の反転)
  - `9`: Strikethrough (取り消し線)
  - `22`: Normal intensity (太字/暗い表示の解除)
  - `23`: Italic off
  - `24`: Underline off
  - `27`: Inverse off
  - `29`: Strikethrough off
- **拡張色 (前景色 38 / 背景色 48)**:
  - `38;5;n` / `48;5;n`: 256色モード (xterm 256-color)
  - `38;2;r;g;b` / `48;2;r;g;b`: RGB 24-bit TrueColor
- **AIXterm 高輝度カラー**:
  - `90-97`: 前景色 (Bright)
  - `100-107`: 背景色 (Bright)

### 3.2 ドメインモデルの拡張 (`src/domain/terminal.rs`)
- `TerminalAttribute` 構造体を拡張し、24ビットカラー（RGB）および上述のスタイルフラグを保持できるようにする。
- デフォルト色（標準の前景色/背景色）の状態管理を正確に行う。

### 3.3 描画処理の実装 (`src/gui/renderer.rs`)
- Windows GDI を使用し、`TerminalAttribute` に基づいた描画を行う。
- `CreateFontIndirectW` 等を用いて、太字、斜体、下線を適用したフォントを動的に切り替える（または生成する）。
- TrueColor および 256色から COLORREF への変換処理を実装する。

## 4. 非機能要件
- **描画パフォーマンス**: 大量の色・スタイル変更が発生しても、ターミナルの応答性を維持する。
- **後方互換性**: 未知の SGR パラメータに遭遇した場合は、無視して処理を続行し、表示を崩さない（ゴミ文字を表示しない）。

## 5. 受け入れ条件
- [ ] 256色表示テスト（例: `colortest-256`）で全色が正しく表示されること。
- [ ] RGB カラーのグラデーションが正しく描画されること。
- [ ] 太字、斜体、下線、取り消し線が混在したテキストが正しく表示されること。
- [ ] `Microsoft Edit` 等の TUI アプリで、背景色やスタイルが意図通りに反映されること。

## 6. スコープ外
- 点滅 (Blink) 属性。
- 非表示 (Hidden) 属性。
- 二重下線、波線下線などの拡張下線スタイル（すべて通常の下線として扱う）。
- 代替フォント (SGR 11-19)。
