# Specification: Support Alt Key Operation in TUI Applications

## Overview
TUI（Text User Interface）アプリケーション（`edit` コマンド、`vim`、`mc` など）において、`Alt` キーを使用したメニュー操作やショートカットキー操作を可能にする。
現状、EmEditor 内のターミナルで `Alt` キーを押すと、EmEditor 本体のメニューバーにフォーカスが移動してしまい、ターミナル内のアプリケーションに `Alt` キー入力が送信されない問題を解決する。

## Functional Requirements
1. **Altキー入力の捕捉と転送**
    - ターミナルウィンドウ（プラグインのビュー）にフォーカスがある場合、`Alt` キー（`VK_MENU`）を含むキー入力を捕捉する。
    - 捕捉した入力を ConPTY（バックエンド）へ送信する。

2. **EmEditor メニュー操作の抑制**
    - ターミナルにフォーカスがある間、`Alt` キー単独押し、および TUI アプリ操作用の `Alt` 組み合わせキーが押された際、EmEditor 本体のメニューバーがアクティブになるのを防ぐ。
    - **ルール**: ターミナルフォーカス時は、基本的に全ての `Alt` キーイベントをターミナルへ送る（横取りする）。

3. **システムショートカットの除外**
    - OS の重要なシステムショートカット（以下の例を参照）は、ターミナルで消費せず、Windows システムへ通過させる。
    - **除外対象**:
        - `Alt + Tab` (ウィンドウ切り替え)
        - `Alt + Esc` (ウィンドウ切り替え)
        - `Alt + Space` (ウィンドウシステムメニュー)
        - `Alt + F4` (ウィンドウを閉じる)

## Non-Functional Requirements
- **パフォーマンス**: キー入力の遅延を感じさせないこと。
- **安定性**: ターミナルからフォーカスが外れた場合、即座に通常の EmEditor の挙動（Altキーでメニュー操作）に戻ること。
- **安全性**: Windows メッセージフックを使用する場合、EmEditor 本体や他のプラグインに悪影響を与えない実装とすること（ウィンドウプロシージャ内での完結を推奨）。

## Implementation Approach
- **メッセージハンドリング**:
    - `Win32 API` のウィンドウプロシージャ (`WndProc`) において、`WM_SYSKEYDOWN` および `WM_SYSKEYUP` メッセージをハンドリングする。
    - `VK_MENU` (Altキー) を検知した場合、そのメッセージを消費（`0` を返す）し、`DefWindowProc` を呼ばないことでメニューのアクティブ化を阻止する。
    - 同時に、対応する入力シーケンスを ConPTY へ書き込む。

## Acceptance Criteria
1. **Alt単独押し**: ターミナルフォーカス時に `Alt` キーを押して離しても、EmEditor のメニューバーにフォーカスが移動しないこと。
2. **TUIメニュー操作**: `edit` コマンドなどで、`Alt + F` を押すと TUI アプリ内の「File」メニューが開くこと。
3. **連続操作**: `Alt` を押しながら矢印キーなどで TUI アプリのメニュー項目を移動できること。
4. **システム連携**: `Alt + Tab` で正常にウィンドウ切り替えができること。
5. **フォーカス移動**: ターミナル外（エディタ部分）をクリックした後、`Alt` キーを押すと、通常通り EmEditor のメニューが操作できること。

## Out of Scope
- EmEditor 本体のショートカットキー設定との競合解決（ユーザー設定で回避可能とする）。
- `Ctrl + Alt` などの特殊な組み合わせの個別制御（基本はすべてターミナルへ送る）。
